# ai_insights/management/commands/seed_insight_details.py
from django.core.management.base import BaseCommand
from django.utils import timezone

from ai_insights.models import (
    Insight,
    InsightAnalysisItem,
    InsightRecommendation,
    InsightTag,
)

# âš ï¸ ì½˜ì†” ì¸ì½”ë”© ë¬¸ì œ(ìœˆë„ìš°) í”¼í•˜ë ¤ê³  print ë‚´ìš©ì€ ASCIIë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
#    ë°ì´í„°ì—ëŠ” ì´ëª¨ì§€ í¬í•¨ë˜ì–´ë„ DB ì €ì¥ì€ ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤(ì½˜ì†”ì— ê·¸ëŒ€ë¡œ ì¶œë ¥ë§Œ í”¼í•¨).

DATA = {
    "insight_001": {
        "tags": [("#í”„ë¡œëª¨ì…˜", "growth"), ("#ì‹œê°„ëŒ€ë§ˆì¼€íŒ…", "retention")],
        "summary": "ìƒê¶Œ ì£¼ë³€ ê¸°ìˆ™ì‚¬ìƒë“¤ì˜ ì£¼ë§ ì ì‹¬ ì†Œë¹„ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ë§¤ì¶œ ì¦ëŒ€ë¥¼ ìœ„í•œ íƒ€ê²ŸíŒ… ì „ëµì„ ì œì•ˆí•©ë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "ğŸ§¾",
                "title": "ë§¤ì¶œ ë°ì´í„°",
                "description": "ìµœê·¼ 3ì£¼ê°„ ì£¼ë§ ì ì‹¬ ë§¤ì¶œì´ í‰ê·  ëŒ€ë¹„ 18% ìƒìŠ¹í•˜ì˜€ìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ“",
                "title": "ì‹œì¥ ë°ì´í„°",
                "description": "ìƒê¶Œ ë‚´ ê¸°ìˆ™ì‚¬ìƒë“¤ì˜ ì£¼ë§ ì™¸ì‹ ë¹ˆë„ê°€ ë‹¤ë¥¸ ìš”ì¼ ëŒ€ë¹„ ë†’ê²Œ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ’¬",
                "title": "SNS íŠ¸ë Œë“œ",
                "description": "â€œê¸°ìˆ™ì‚¬â€, â€œì ì‹¬ ë©”ë‰´ ì¶”ì²œâ€, â€œí˜¼ë°¥ ë§›ì§‘â€ ê´€ë ¨ í‚¤ì›Œë“œê°€ ì£¼ë§ ì ì‹¬ ì‹œê°„ëŒ€ì— SNSì—ì„œ ê¸‰ì¦í•˜ì˜€ìŠµë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸ¯",
            "item_title": "SNS ê¸°ë°˜ ì£¼ë§ ì ì‹¬ íƒ€ê²ŸíŒ… í”„ë¡œëª¨ì…˜ ì œì•ˆ",
            "item_description": "ì£¼ë³€ ê¸°ìˆ™ì‚¬ ë°˜ê²½ 1.5km ë‚´ íƒ€ê²Ÿ ìœ ì €ì—ê²Œ ë°°ë‹¬ì•± ì¿ í° + SNS í™ë³´ìš© ë©”ë‰´ ì¹´ë“œ ì½˜í…ì¸  ì¡°í•©ì„ ì¶”ì²œí•©ë‹ˆë‹¤.\nì ì‹¬ ì „ íƒ€ì´ë°(ì˜¤ì „ 11ì‹œ)ì— ë©”ì‹œì§€ë¥¼ ë°œì†¡í•˜ì—¬ â€œí˜¼ë°¥ í• ì¸ ì„¸íŠ¸â€ë¥¼ ë…¸ì¶œí•˜ì„¸ìš”!",
        },
    },
    "insight_002": {
        "tags": [("#ê´‘ê³ ", "growth"), ("#SNSì „í™˜", "retention")],
        "summary": "SNS ìœ ì… ëŒ€ë¹„ ì „í™˜ íš¨ìœ¨ì´ ë†’ì•„ ê´‘ê³  ì˜ˆì‚° ì¦ì•¡ ì‹œ ì„±ê³¼ ê°œì„  ì—¬ì§€ê°€ í½ë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "ğŸ“ˆ",
                "title": "ì „í™˜ ë°ì´í„°",
                "description": "ìµœê·¼ 2ì£¼ê°„ SNS ì „í™˜ìœ¨ì´ í‰ê·  ëŒ€ë¹„ 2ë°° ë†’ê²Œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ’µ",
                "title": "CAC ë¹„êµ",
                "description": "ë™ì¼ ì˜ˆì‚° ëŒ€ë¹„ SNS ì±„ë„ CACê°€ ë‹¤ë¥¸ ì±„ë„ë³´ë‹¤ 23% ë‚®ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ§­",
                "title": "ê³ ê° ê²½ë¡œ",
                "description": "SNS â†’ ëœë”© â†’ ë°°ë‹¬ì•±ë¡œ ì´ì–´ì§€ëŠ” ê²½ë¡œì—ì„œ ì´íƒˆë¥ ì´ ë‚®ìŠµë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸš€",
            "item_title": "SNS ì˜ˆì‚° 20~30% ì¦ì•¡ ë° ì„±ê³¼í˜• ìº í˜ì¸ í™•ëŒ€",
            "item_description": "í´ë¦­-ì „í™˜ ìµœì í™” ìº í˜ì¸ ë¹„ì¤‘ì„ ëŠ˜ë¦¬ê³ , ìƒìœ„ 3ê°œ í¬ë¦¬ì—ì´í‹°ë¸Œì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ì„¸ìš”.",
        },
    },
    "insight_003": {
        "tags": [("#ë¸ŒëŸ°ì¹˜", "growth"), ("#ë©”ë‰´ê¸°íš", "expansion")],
        "summary": "ë¸ŒëŸ°ì¹˜ í‚¤ì›Œë“œ ìˆ˜ìš”ê°€ ì¦ê°€í•˜ëŠ” ì‹œì ì— ì„¸íŠ¸ êµ¬ì„± ìµœì í™”ë¥¼ í†µí•´ ë§¤ì¶œ í™•ëŒ€ë¥¼ ë…¸ë¦½ë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "ğŸ”",
                "title": "ê²€ìƒ‰ íŠ¸ë Œë“œ",
                "description": "ë¸ŒëŸ°ì¹˜ í‚¤ì›Œë“œ ê²€ìƒ‰ëŸ‰ì´ ì „ì›” ëŒ€ë¹„ 40% ì¦ê°€í–ˆìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ½ï¸",
                "title": "ë©”ë‰´ ì„ í˜¸",
                "description": "ìƒŒë“œ/ì»¤í”¼ ì¡°í•©ì˜ ì£¼ë¬¸ ë¹ˆë„ê°€ ë™ì‹œê°„ëŒ€ íƒ€ ë©”ë‰´ë³´ë‹¤ 28% ë†’ìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ•’",
                "title": "ì‹œê°„ëŒ€ íŠ¹ì„±",
                "description": "í† Â·ì¼ 10~13ì‹œ ì£¼ë¬¸ ì§‘ì¤‘ë„ê°€ í‰ì¼ ëŒ€ë¹„ 1.7ë°° ë†’ìŠµë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸ§º",
            "item_title": "ë¸ŒëŸ°ì¹˜ ì„¸íŠ¸(ë©”ì¸+ìŒë£Œ) ë²ˆë“¤ ì¶œì‹œ",
            "item_description": "ì„¸íŠ¸ êµ¬ë§¤ ì‹œ 10% í• ì¸ê³¼ í¬í† ì¹´ë“œ ì¦ì • ì´ë²¤íŠ¸ë¥¼ í•¨ê»˜ ìš´ì˜í•˜ì„¸ìš”.",
        },
    },
    "insight_004": {
        "tags": [("#ë¦¬í…ì…˜", "retention"), ("#í˜œíƒì„¤ê³„", "retention")],
        "summary": "ì¬ë°©ë¬¸ ê³ ê° ë¹„ì¤‘ì´ ëŠ˜ì–´ë‚˜ëŠ” êµ¬ê°„ì—ì„œ ì¶©ì„±ë„ í”„ë¡œê·¸ë¨ì„ ì •êµí™”í•©ë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "ğŸ”",
                "title": "ì¬êµ¬ë§¤ìœ¨",
                "description": "ìµœê·¼ 30ì¼ ì¬êµ¬ë§¤ìœ¨ì´ 14%p ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ",
                "title": "í˜œíƒ ë°˜ì‘",
                "description": "ë„ì¥/í¬ì¸íŠ¸ ì ë¦½ ì°¸ì—¬ìœ¨ì´ 1ê°œì›” ì „ ëŒ€ë¹„ 31% ëŠ˜ì—ˆìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ“Š",
                "title": "ì„¸ê·¸ë¨¼íŠ¸",
                "description": "í‰ê·  êµ¬ë§¤ì£¼ê¸° 9~12ì¼ ì„¸ê·¸ë¨¼íŠ¸ê°€ ì „ì²´ì˜ 26%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸ·ï¸",
            "item_title": "N+1 ì¿ í°/ë“±ê¸‰ë³„ í˜œíƒ ë¦¬ë‰´ì–¼",
            "item_description": "3íšŒ ë°©ë¬¸ ì‹œ ë¬´ë£Œ ì‚¬ì´ë“œ ì œê³µ, VIP 5% ìƒì‹œ í• ì¸ìœ¼ë¡œ LTVë¥¼ ì¦ëŒ€í•˜ì„¸ìš”.",
        },
    },
    "insight_005": {
        "tags": [("#ë¸Œëœë”©", "retention"), ("#ê²½ìŸë¶„ì„", "expansion")],
        "summary": "ë¸Œëœë“œ ê²€ìƒ‰ëŸ‰ì´ ë‚®ì•„ ìƒìœ„ í¼ë„ ì¸ì§€ë„ ì œê³ ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "ğŸ”",
                "title": "ë¸Œëœë“œ ê²€ìƒ‰",
                "description": "ë¸Œëœë“œ í‚¤ì›Œë“œ ê²€ìƒ‰ëŸ‰ì´ ì§€ì—­ í‰ê·  ëŒ€ë¹„ 30% ë‚®ìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ",
                "title": "ê²½ìŸì‚¬ ë¹„êµ",
                "description": "ê²½ìŸ A, B ëŒ€ë¹„ SNS ì–¸ê¸‰ëŸ‰ë„ ì—´ì„¸ì…ë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ–¼ï¸",
                "title": "ìì‚° í™œìš©",
                "description": "ì‹œê·¸ë‹ˆì²˜ ë©”ë‰´ ë¹„ì£¼ì–¼ ìì‚°ì˜ ì¬í™œìš©ë„ê°€ ë‚®ìŠµë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸ“£",
            "item_title": "ì‹œê·¸ë‹ˆì²˜ ìº í˜ì¸ ë° ì§€ì—­ í•´ì‹œíƒœê·¸ í™•ì‚°",
            "item_description": "ì‹œì¦Œ í•´ì‹œíƒœê·¸ + ì‚¬ìš©ì ì°¸ì—¬í˜• UGC ì´ë²¤íŠ¸ë¡œ ìƒìœ„ í¼ë„ ì¸ì§€ë„ë¥¼ ëŒì–´ì˜¬ë¦¬ì„¸ìš”.",
        },
    },
    "insight_006": {
        "tags": [("#ì‹ ë©”ë‰´", "growth"), ("#ì—¬ë¦„ìŒë£Œ", "growth")],
        "summary": "ê¸°ì˜¨ ìƒìŠ¹ê³¼ í•¨ê»˜ ì²­ëŸ‰ ìŒë£Œ ìˆ˜ìš”ê°€ ì»¤ì§€ê³  ìˆì–´ ì‹ ì œí’ˆ ì¶œì‹œ ì ê¸°ì…ë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "ğŸŒ¡ï¸",
                "title": "ê¸°ìƒ ì˜í–¥",
                "description": "í‰ê·  ê¸°ì˜¨ 2â„ƒ ìƒìŠ¹ êµ¬ê°„ì—ì„œ ëƒ‰ìŒë£Œ ë§¤ì¶œì´ 19% ì¦ê°€í–ˆìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ¥¤",
                "title": "ë©”ë‰´ íŠ¸ë Œë“œ",
                "description": "ìƒê¶Œ ë‚´ ê³¼ì¼Â·ì—ì´ë“œ ê³„ì—´ì˜ ê²€ìƒ‰ëŸ‰ì´ ëšœë ·ì´ ì¦ê°€í•©ë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ§ª",
                "title": "í…ŒìŠ¤íŠ¸ ë°˜ì‘",
                "description": "ì‹œìŒ ì´ë²¤íŠ¸ì—ì„œ ì¬êµ¬ë§¤ ì˜í–¥ 72%ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸ§Š",
            "item_title": "ì—¬ë¦„ í•œì • ì‹ ë©”ë‰´ ë¡ ì¹­ + ì„¸íŠ¸ ë²ˆë“¤",
            "item_description": "ëŸ°ì¹­ ì²« ì£¼ ì¸ìŠ¤íƒ€ ë¦´ìŠ¤/ìŠ¤í† ë¦¬ ì§‘ì¤‘ ì†¡ì¶œê³¼ ë²ˆë“¤(ìŒë£Œ+ë””ì €íŠ¸) ìš´ì˜ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
        },
    },
    "insight_007": {
        "tags": [("#ë¹„ìˆ˜ê¸°í•´ì†Œ", "growth"), ("#ì €ë…íƒ€ì„", "retention")],
        "summary": "ì£¼ì¤‘ ì €ë… ë§¤ì¶œ ì €í•˜ êµ¬ê°„ì— ì‹œê°„ëŒ€ íŠ¹í™” í”„ë¡œëª¨ì…˜ì„ ì ìš©í•´ íšŒë³µì„ ë•ìŠµë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "â°",
                "title": "ì‹œê°„ëŒ€ ë§¤ì¶œ",
                "description": "18~20ì‹œ ë§¤ì¶œì´ ì „ì²´ í‰ê·  ëŒ€ë¹„ 22% ë‚®ìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ‘¥",
                "title": "ë°©ë¬¸ íŒ¨í„´",
                "description": "2ì¸ ë°©ë¬¸ ë¹„ì¤‘ì´ ë†’ì•„ ê³µìœ í˜• ë©”ë‰´ ì„ í˜¸ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ’³",
                "title": "ê²°ì œ ë‹¨ê°€",
                "description": "ì €ë… ì‹œê°„ëŒ€ ê°ë‹¨ê°€ê°€ ì ì‹¬ ëŒ€ë¹„ 15% ë‚®ìŠµë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸ«",
            "item_title": "ì£¼ì¤‘ ì €ë… ì „ìš© ì„¸íŠ¸/íƒ€ì„ì„¸ì¼",
            "item_description": "18~20ì‹œ í•œì • ì½¤ë³´ ì„¸íŠ¸ 10% í• ì¸ + ìŠ¤íƒ¬í”„ 2ë°° ì ë¦½ì„ ë³‘í–‰í•˜ì„¸ìš”.",
        },
    },
    "insight_008": {
        "tags": [("#ê°€ê²©ì •ì±…", "expansion"), ("#ê²½ìŸëª¨ë‹ˆí„°ë§", "expansion")],
        "summary": "ê²½ìŸì‚¬ ê°€ê²© ì¸í•˜ ì´ìŠˆì— ëŒ€ì‘í•´ ë¯¼ê° ë©”ë‰´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì „ëµì„ ì¬ì •ë ¬í•©ë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "ğŸ·ï¸",
                "title": "ê°€ê²© ë¯¼ê°ë„",
                "description": "í•µì‹¬ ë©”ë‰´ 3ì¢…ì˜ íƒ„ë ¥ì„±ì´ ë†’ì€ í¸ì…ë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ§®",
                "title": "ë§ˆì§„ ë¶„ì„",
                "description": "ë™ì¼ ë©”ë‰´ì˜ ì¬ë£Œë¹„ ìƒìŠ¹ìœ¼ë¡œ ë§ˆì§„ìœ¨ 3%p í•˜ë½ ì¶”ì„¸ì…ë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ“ˆ",
                "title": "ìˆ˜ìš” ëŒ€ì²´",
                "description": "ê²½ìŸì‚¬ í• ì¸ ê¸°ê°„ì— ì£¼ë¬¸ ì´íƒˆì´ ê´€ì¸¡ë©ë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "âš–ï¸",
            "item_title": "ê°€ê²© ë°©ì–´ + ê°€ì¹˜ ê°•ì¡°",
            "item_description": "ì„¸íŠ¸ ì—…ì…€/ê°€ì¹˜ ë©”ì‹œì§€ ê°•í™”ë¡œ ê°€ê²© ë¯¼ê°ë„ë¥¼ ì™„í™”í•˜ê³  ë¯¼ê° ë©”ë‰´ëŠ” í•œì‹œ ë²ˆë“¤ë¡œ ëŒ€ì‘í•˜ì„¸ìš”.",
        },
    },
    "insight_009": {
        "tags": [("#ë¦¬ë·°ê°œì„ ", "retention"), ("#ê³ ê°ê²½í—˜", "retention")],
        "summary": "ë¦¬ë·° í‰ì /ì‘ë‹µì†ë„ ê°œì„ ì„ í†µí•´ ì „í™˜Â·ì¬ë°©ë¬¸ì„ í•¨ê»˜ ëŒì–´ì˜¬ë¦½ë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "â­",
                "title": "í‰ì  ë¶„í¬",
                "description": "ìµœê·¼ 14ì¼ 3â˜… ì´í•˜ ë¦¬ë·° ë¹„ì¤‘ì´ ë†’ì•„ì¡ŒìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ’¬",
                "title": "ì‘ë‹µ ì†ë„",
                "description": "ë¦¬ë·° ì‘ë‹µ í‰ê·  19ì‹œê°„ìœ¼ë¡œ ìƒê¶Œ í‰ê· ì„ ìƒíšŒí•©ë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ§©",
                "title": "ì›ì¸ ë¶„ì„",
                "description": "í¬ì¥ ì˜¨ë„/í¬ì¥ì¬ ê´€ë ¨ í”¼ë“œë°±ì´ ë°˜ë³µë©ë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸ› ï¸",
            "item_title": "ë¦¬ë·° SLAÂ·í…œí”Œë¦¿ ë„ì…",
            "item_description": "ì‘ë‹µ SLA 6ì‹œê°„, ê°œì„  ì•½ì† í…œí”Œë¦¿ì„ ë„ì…í•˜ê³  í¬ì¥ì¬ ì˜µì…˜ì„ ê°œì„ í•˜ì„¸ìš”.",
        },
    },
    "insight_010": {
        "tags": [("#í…Œì´í¬ì•„ì›ƒ", "growth"), ("#ë™ì„ ìµœì í™”", "retention")],
        "summary": "í…Œì´í¬ì•„ì›ƒ ìˆ˜ìš”ê°€ ëŠ˜ë©° íšŒì „ìœ¨ ê°œì„ ê³¼ ëŒ€ê¸° ì²´ê° ê°ì†Œê°€ ì¤‘ìš”í•´ì¡ŒìŠµë‹ˆë‹¤.",
        "analysis": [
            {
                "icon": "ğŸš¶",
                "title": "ì£¼ë¬¸ ì±„ë„",
                "description": "í¬ì¥ ì£¼ë¬¸ ë¹„ì¤‘ì´ 25%ë¡œ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ“¦",
                "title": "í¬ì¥ íš¨ìœ¨",
                "description": "í”¼í¬íƒ€ì„ í¬ì¥ ëŒ€ê¸° ì‹œê°„ì´ 6ë¶„ì„ ì´ˆê³¼í•©ë‹ˆë‹¤.",
            },
            {
                "icon": "ğŸ§­",
                "title": "ë§¤ì¥ ë™ì„ ",
                "description": "í”½ì—… ìŠ¤í…Œì´ì…˜ ë¶„ë¦¬ê°€ ë¯¸í¡í•˜ì—¬ ì²´ê° ëŒ€ê¸°ê°€ ì»¤ì§‘ë‹ˆë‹¤.",
            },
        ],
        "recommendation": {
            "title": "ì¶”ì²œ ì‹¤í–‰ ê³„íš",
            "item_icon": "ğŸ“",
            "item_title": "í”½ì—… ìŠ¤í…Œì´ì…˜/ì‚¬ì „ì£¼ë¬¸ ê°œì„ ",
            "item_description": "í”½ì—… ì¡´ ë¶„ë¦¬ì™€ ì‚¬ì „ì£¼ë¬¸ ì•ˆë‚´ë¥¼ ê°•í™”í•´ ì²´ê° ëŒ€ê¸°ë¥¼ ì¤„ì´ê³  íšŒì „ìœ¨ì„ ë†’ì´ì„¸ìš”.",
        },
    },
}


def _get_or_create_tags(tag_pairs):
    """
    tag_pairs: [("#í”„ë¡œëª¨ì…˜","growth"), ...]
    returns: [InsightTag, ...]
    """
    result = []
    for text, typ in tag_pairs:
        tag, _ = InsightTag.objects.get_or_create(text=text, type=typ)
        result.append(tag)
    return result


def upsert_detail(ins: Insight, payload: dict):
    # summary
    ins.description = payload.get("summary") or ins.description
    # íƒœê·¸
    tags = _get_or_create_tags(payload.get("tags", []))
    if tags:
        ins.tags.set(tags)

    # ë¶„ì„ ì•„ì´í…œ
    ins.analysis_items.all().delete()
    items = payload.get("analysis", [])
    for idx, item in enumerate(items):
        InsightAnalysisItem.objects.create(
            insight=ins,
            icon=item.get("icon", "") or "",
            title=item.get("title", "") or "",
            description=item.get("description", "") or "",
            order=idx,
        )

    # ì¶”ì²œ(ìƒì„¸ 1ê°œ)
    rec = payload.get("recommendation")
    if rec:
        InsightRecommendation.objects.update_or_create(
            insight=ins,
            defaults=dict(
                title=rec.get("title", "") or "",
                item_icon=rec.get("item_icon", "") or "",
                item_title=rec.get("item_title", "") or "",
                item_description=rec.get("item_description", "") or "",
            ),
        )


class Command(BaseCommand):
    help = "Seed/Update insight details (summary/analysis/recommendation) for insights 001~010"

    def handle(self, *args, **options):
        updated = 0
        for ins in Insight.objects.filter(id__in=list(DATA.keys())):
            payload = DATA.get(ins.id)
            if not payload:
                continue
            upsert_detail(ins, payload)
            updated += 1
        self.stdout.write(self.style.SUCCESS(f"done. updated: {updated} insights"))
